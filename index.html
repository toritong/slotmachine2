import React, { useState, useEffect } from 'react';
import { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle } from "@/components/ui/alert-dialog";

const SlotMachine = () => {
  const [spinning, setSpinning] = useState(false);
  const [usedNumbers, setUsedNumbers] = useState(new Set());
  const [reels, setReels] = useState([0, 0, 0]);
  const [showAlert, setShowAlert] = useState(false);
  
  // Fruit images represented by emojis
  const fruits = ['ðŸŽ', 'ðŸ', 'ðŸŠ', 'ðŸ‹', 'ðŸŒ', 'ðŸ‰', 'ðŸ‡', 'ðŸ“', 'ðŸ‘', 'ðŸ'];

  const generateUniqueNumber = () => {
    if (usedNumbers.size >= 100) {
      setShowAlert(true);
      return null;
    }

    let number;
    do {
      number = Math.floor(Math.random() * 100);
    } while (usedNumbers.has(number));

    return number;
  };

  const spin = () => {
    if (spinning) return;
    
    const number = generateUniqueNumber();
    if (number === null) return;

    setSpinning(true);
    
    // Always set first reel to 0
    const firstReel = 0;
    // Extract middle and right digits from the generated number
    const middleReel = Math.floor(number / 10);
    const rightReel = number % 10;
    
    // Simulate spinning animation
    let counter = 0;
    const spinInterval = setInterval(() => {
      setReels(prev => [
        Math.floor(Math.random() * 10),
        Math.floor(Math.random() * 10),
        Math.floor(Math.random() * 10)
      ]);
      
      counter++;
      if (counter >= 20) {
        clearInterval(spinInterval);
        setReels([firstReel, middleReel, rightReel]);
        setSpinning(false);
        setUsedNumbers(prev => new Set([...prev, number]));
      }
    }, 50);
  };

  const resetGame = () => {
    setUsedNumbers(new Set());
    setReels([0, 0, 0]);
    setShowAlert(false);
  };

  return (
    <div className="flex flex-col items-center justify-center p-8 bg-gray-100 rounded-lg shadow-lg">
      <div className="mb-8 text-2xl font-bold">ðŸŽ° Fruit Slot Machine ðŸŽ°</div>
      
      <div className="flex gap-4 p-6 bg-white rounded-xl shadow-inner">
        {reels.map((value, index) => (
          <div 
            key={index}
            className="w-24 h-24 flex items-center justify-center text-6xl bg-yellow-100 rounded-lg shadow-md"
          >
            {fruits[value]}
          </div>
        ))}
      </div>

      <div className="mt-8 text-xl">
        Number: {reels[1] * 10 + reels[2]}
      </div>
      
      <div className="mt-4">
        Numbers used: {usedNumbers.size}/100
      </div>

      <button
        onClick={spin}
        disabled={spinning || usedNumbers.size >= 100}
        className={`mt-6 px-8 py-4 text-xl font-bold text-white rounded-full shadow-lg transition-transform transform hover:scale-105 ${
          spinning || usedNumbers.size >= 100 
            ? 'bg-gray-400 cursor-not-allowed' 
            : 'bg-red-500 hover:bg-red-600'
        }`}
      >
        {spinning ? 'Spinning...' : 'SPIN!'}
      </button>

      <button
        onClick={resetGame}
        className="mt-4 px-6 py-2 text-sm text-gray-600 hover:text-gray-800 underline"
      >
        Reset Game
      </button>

      <AlertDialog open={showAlert}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Game Over!</AlertDialogTitle>
            <div className="mt-2">
              You've used all 100 possible numbers. Click "Reset Game" to start over.
            </div>
          </AlertDialogHeader>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  );
};

export default SlotMachine;
